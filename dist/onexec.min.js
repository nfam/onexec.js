!function(factory){if("object"==typeof module&&"object"==typeof module.exports){var v=factory(require,exports);void 0!==v&&(module.exports=v)}else"function"==typeof define&&define.amd&&define(["require","exports"],factory)}(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var immediate="function"==typeof setImmediate?setImmediate:function(handler){setTimeout(handler,0)};exports.default=class{constructor(execute){this._requestedOn=null,this._completedOn=null,this._execute=execute,this._executing=!1,this._callbacks=[]}get requestedOn(){return this._requestedOn}get completedOn(){return this._completedOn}get executing(){return this._executing}_resolve(result){return this._executing=!1,this._completedOn=new Date,this._callbacks.forEach(callback=>{immediate(()=>{callback.resolve(result)})}),this._callbacks=[],Promise.resolve(result)}_reject(error){return this._executing=!1,this._completedOn=new Date,this._callbacks.forEach(callback=>{immediate(()=>{callback.reject(error)})}),this._callbacks=[],Promise.reject(error)}_doexecute(...args){this._requestedOn=new Date;try{var result=this._execute(...args);return"object"==typeof result&&"function"==typeof result.then&&"function"==typeof result.catch?result.then(result=>this._resolve(result),error=>this._reject(error)):this._resolve(result)}catch(error){return this._reject(error)}}run(...args){return this._executing?new Promise((resolve,reject)=>{if(!this._executing)return this._doexecute(...args);this._callbacks.push({resolve:resolve,reject:reject})}):(this._executing=!0,this._doexecute(...args))}wait(){return this._executing?new Promise((resolve,reject)=>{this._executing?this._callbacks.push({resolve:()=>{resolve()},reject:()=>{resolve()}}):resolve()}):Promise.resolve()}}});